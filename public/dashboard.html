<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Investor Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    /* (Styles unchanged for brevity) */
  </style>
</head>
<body>
  <main class="dashboard" role="main" aria-label="Investor Dashboard">
    <section class="profile">
      <div class="profile-pic">
        <img src="https://i.pravatar.cc/150?img=68" alt="User profile photo" />
      </div>
      <div class="profile-info">
        <h2 id="user-name">Jane Doe</h2>
        <p>Investor since 2021</p>
      </div>
    </section>

    <section class="balance">
      <div class="balance-text">
        <span class="label">Total Portfolio Value</span>
        <span class="amount" id="portfolio-value">Loading...</span>
      </div>
      <div class="growth" id="growth-status">
        <span class="material-icons">trending_up</span>
        +0.0%
      </div>
    </section>

    <section>
      <h3>Model Upload</h3>
      <input type="file" id="model-upload" accept=".zip" />
      <button onclick="uploadZip()">Upload ZIP</button>
      <input type="text" id="model-url" placeholder="Paste ZIP URL here" style="margin-top: 10px; width: 100%" />
      <button onclick="downloadZip()">Download & Load from URL</button>
    </section>

    <section>
      <h3>Trading Bot</h3>
      <button id="trade-btn" onclick="toggleTrading()">Checking status...</button>
    </section>
  </main>

  <script>
    async function fetchStatus() {
      const res = await fetch('/api/status');
      const data = await res.json();
      document.getElementById('trade-btn').textContent = data.trading ? 'Stop Trading' : 'Start Trading';
      document.getElementById('trade-btn').dataset.trading = data.trading;
    }

    async function fetchBalance() {
      const res = await fetch('/api/chart-data');
      const data = await res.json();
      if (data.ticks && data.ticks.length > 0) {
        const price = parseFloat(data.ticks[data.ticks.length - 1].quote);
        document.getElementById('portfolio-value').textContent = `$${price.toFixed(2)}`;
      }
    }

    async function uploadZip() {
      const fileInput = document.getElementById('model-upload');
      const file = fileInput.files[0];
      if (!file) return alert('No file selected.');

      const formData = new FormData();
      formData.append('model', file);

      const res = await fetch('/upload-zip', {
        method: 'POST',
        body: formData
      });
      const result = await res.json();
      alert(result.message || 'Upload done.');
    }

    async function downloadZip() {
      const url = document.getElementById('model-url').value;
      if (!url) return alert('No URL provided.');

      const res = await fetch('/download-zip', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      });
      const result = await res.json();
      alert(result.message || 'Download done.');
    }

    async function toggleTrading() {
      const trading = document.getElementById('trade-btn').dataset.trading === 'true';

      if (!trading) {
        // Check if model was uploaded
        const confirmStart = confirm('Ensure a ZIP model has been uploaded. Proceed to start trading?');
        if (!confirmStart) return;
        const res = await fetch('/trade-start', { method: 'POST' });
        const result = await res.json();
        alert(result.message || 'Started');
      } else {
        const res = await fetch('/trade-end', { method: 'POST' });
        const result = await res.json();
        alert(result.message || 'Stopped');
      }
      fetchStatus();
    }

    fetchStatus();
    fetchBalance();
  </script>
</body>
</html>
